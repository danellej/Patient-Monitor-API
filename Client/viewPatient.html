<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">   
    <link rel="stylesheet" href="singlePatient.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script> -->
    <script src="https://kit.fontawesome.com/e737345155.js" crossorigin="anonymous"></script>
    <title>View Patient</title>
</head>

<body>
<div class="container">
    <div class="page-header">
        <h1 class="text-center" style = font-family:Georgia> <i class="fa fa-heartbeat" style = "color:rgb(143, 68, 68)"></i>Patient Monitoring System <i class="fa fa-stethoscope" style ="color:rgb(143, 68, 68)"></i></h1>  
    </div>
</div>

<nav class="navbar navbar-inverse">
    <div class = "container-fluid">
        <!-- <div class = "navbar-header" style = "font-size: medium; color:rgb(143, 68, 68)"> Patient Monitor Menu </div> -->
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>                        
        </button>
            <div class="navbar-brand" style = "font-size: medium; color:rgb(143, 68, 68)" href="#">Patient Monitor Menu</div>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
        <ul class = "nav navbar-nav navbar-right">
            <li>  <a href="index.html">Home <span class="glyphicon glyphicon-home"></span> </a></span> </li>
            <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">Administrators <i class="fa fa-user-md"></i><span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="adminLogin.html">Admin Login</a></li>
                        <li><a href="newAdmin.html">New Admin</a></li>
                    </ul>
                  </li>
            <li class = "dropdown">
            <a class = "dropdown-toggle" data-toggle="dropdown" href="#">Patient Menu <i class="fa fa-wheelchair"></i> <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li><a href="addPatient.html">Add New Patient</a></li>
                  <li class="dropdown-submenu" style="position: relative;">
                      <a class="test" href="#">View Patients <span class="caret"></span></a>
                      <ul class="dropdown-menu">
                          <li><a href="viewPatients.html">View All Patients</a></li>
                          <li><a href="viewPatient.html">View Patient by ID</a></li>
                      </ul>
                  </li>
                  <li><a href="updatePatient.html">Update Patient</a></li>
                  <li><a href="deletePatient.html">Delete Patient</a></li>
                </ul>
                    </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container" style="text-align: center">
    <!-- <h4>View Patient by ID Number</h4> -->
    <form class="form-horizontal" id="view-form">
        <div class="input-group" style="width: 300px;">
            <input type="text" autocomplete="off" id="singlePatient" class="form-control" placeholder="Enter patient ID number">
            <div class="input-group-btn">
                <button class="btn btn-default" type="submit" id="search">
                    <i class="glyphicon glyphicon-search"></i>
                </button>
            </div>
        </div>
    </form>

    <div class="container-fluid bg-3 text-center" style="padding-top: 30px;">    
        <div class="row">
            <div class="col-xs-2">
                <p id="patientInfo" style="margin-left: 4.16666667%; color:rgb(143, 68, 68);"></p>
              </div>
          <div class="col-xs-2">
            <p id="nameHolder" style="color:rgb(143, 68, 68);"></p>
            <p id="patientName" style="margin-left: 4.16666667%;"></p>
          </div>
          <div class="col-xs-2"> 
            <p id="ageHolder" style="color:rgb(143, 68, 68);"></p>
            <p id="patientAge" style="margin-left: 4.16666667%;"></p>
          </div>
          <div class="col-xs-2"> 
            <p id="emailHolder" style="color:rgb(143, 68, 68);"></p>
            <p id="patientNurse" style="margin-left: 4.16666667%;"></p>
          </div>
          <div class="col-xs-2"> 
            <p id="posHolder" style="color:rgb(143, 68, 68);"></p>
            <p id="patientPos" style="margin-left: 4.16666667%;"></p>
          </div>
        </div>
      </div>  

    <div>
        <table id="patientTable" class="table table-bordered">
            <caption id="tableCaption"></caption>
        </table>
    </div>

    <div class="container-fluid bg-3 text-center" style="padding-bottom: 48px;">    
        <div class="row">
          <div class="col-sm-4" id="chartContainerTMP" style="height:300px;">
          </div>
          <div class="col-sm-4">
              <table id="tmpTable" class="table table-bordered" style="width: 400px; max-height: 300px; overflow: auto; display: block;">
                <caption id="tmpTableCaption"></caption>
              </table>
          </div>
          <div class="col-sm-4"> 
              <form>
                  <label for="tempAlert">Sort Temp Alerts</label>
                  <input type="date" id="tempDate">
                  <input type="submit" id="tempSubmit">
              </form>
              <p id="tempMsg"></p>
              <table id="alertTable1" class="table table-bordered" style="width: 280px; max-height: 250px; overflow: auto; display: block;"></table>
          </div>
        </div>
      </div>  
      
      <div class="container-fluid bg-3 text-center" style="padding-bottom: 48px;">    
        <div class="row">
          <div class="col-sm-4" id="chartContainerBP" style="height:300px;">
          </div>
          <div class="col-sm-4">
              <table id="bpTable" class="table table-bordered" style="width: 400px; max-height: 300px; overflow: auto; display: block;">
                <caption id="bpTableCaption"></caption>
              </table>
          </div>
          <div class="col-sm-4"> 
            <form>
                <label for="bpAlert">Sort BP Alerts</label>
                <input type="date" id="bpDate">
                <input type="submit" id="bpSubmit">
            </form>
            <p id="bpMsg"></p>
            <table id="alertTable2" class="table table-bordered" style="width: 400px; max-height: 250px; overflow: auto; display: block;"></table>
          </div>
        </div>
      </div>

      <div class="container-fluid bg-3 text-center" style="padding-bottom: 48px;">    
        <div class="row">
          <div class="col-sm-4" id="chartContainerHRM" style="height:300px">
          </div>
          <div class="col-sm-4">
              <table id="pulseTable" class="table table-bordered" style="width: 400px; max-height: 300px; overflow: auto; display: block;">
                <caption id="pulseTableCaption"></caption>
              </table>
          </div>
          <div class="col-sm-4"> 
            <form>
                <label for="pulseAlert">Sort Pulse Alerts</label>
                <input type="date" id="pulseDate">
                <input type="submit" id="pulseSubmit">
            </form>
            <p id="pulseMsg"></p>
            <table id="alertTable3" class="table table-bordered" style="width: 280px; max-height: 250px; overflow: auto; display: block;"></table>
          </div>
        </div>
      </div>

</div>


<script>
$(document).ready(function(){
    $('.dropdown-submenu a.test').on("click", function(e){
        $(this).next('ul').toggle();
        e.stopPropagation();
        e.preventDefault();
    });
});
</script>

<script>
    document.getElementById("tempSubmit").addEventListener("click", function(e){
        e.preventDefault();
        var patientId = $("#singlePatient").val(); var x = document.getElementById("tempDate").value;
        // document.getElementById("tempMsg").innerHTML = "Date: " + x;

        $.get("http://192.168.1.128:3000/patient/date/"+patientId+"/"+x, function(object, status){
            var alertTable1 = document.getElementById("alertTable1");

            var patientData = object;
 
            patientData.map((patient)=>{
                if (patient.tempAlert === true){
            $("#alertTable1").append(`\
            <thead>/
            <tr>\
                <th>Temperature (°C)</th>\
                <th>Time</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patient.temperatureCur}</td>\
                <td>${patient.time}</td>\
            </tr>\
            </tbody>\
            `)
            }
        })
        })

    });

    document.getElementById("bpSubmit").addEventListener("click", function(e){
        e.preventDefault();
        var patientId = $("#singlePatient").val(); var x = document.getElementById("bpDate").value;
        // document.getElementById("bpMsg").innerHTML = "Date: " + x;

        $.get("http://192.168.1.128:3000/patient/date/"+patientId+"/"+x, function(object, status){
            var alertTable2 = document.getElementById("alertTable2");

            var patientData = object;
 
            patientData.map((patient)=>{
                if (patient.bpAlert === true){
            $("#alertTable2").append(`\
            <thead>/
            <tr>\
                <th>Blood Pressure (mmHg)</th>\
                <th>Time</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patient.bloodPressureSys}/${patient.bloodPressureDias}</td>\
                <td>${patient.time}</td>\
            </tr>\
            </tbody>\
            `)}
        })
        })

    });

    document.getElementById("pulseSubmit").addEventListener("click", function(e){
        e.preventDefault();
        var patientId = $("#singlePatient").val(); var x = document.getElementById("pulseDate").value;
        // document.getElementById("pulseMsg").innerHTML = "Date: " + x;

        $.get("http://192.168.1.128:3000/patient/date/"+patientId+"/"+x, function(object, status){
            var alertTable3 = document.getElementById("alertTable3");

            var patientData = object;
 
            patientData.map((patient)=>{
                if (patient.pulseAlert === true){
            $("#alertTable3").append(`\
            <thead>/
            <tr>\
                <th>Heart Rate (bpm)</th>\
                <th>Time</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patient.pulseRateCur}</td>\
                <td>${patient.time}</td>\
            </tr>\
            </tbody>\
            `)}
        })
        })

    });
</script>

<script>
    document.getElementById("search").addEventListener("click", function(e){
        e.preventDefault();
        var patientId = $("#singlePatient").val();
        $.get("http://192.168.1.128:3000/patient/patientId/"+patientId, function(patientObject, status){
            var patientName = document.getElementById("patientName");
            var patientAge = document.getElementById("patientAge");
            var patientNurse = document.getElementById("patientNurse");
            var posHolder = document.getElementById("posHolder");
            var emailHolder = document.getElementById("emailHolder");
            var ageHolder = document.getElementById("ageHolder");
            var nameHolder = document.getElementById("nameHolder");
            posHolder.style.fontWeight = 'bold'; posHolder.style.fontSize = '16px'
            emailHolder.style.fontWeight = 'bold'; emailHolder.style.fontSize = '16px'
            ageHolder.style.fontWeight = 'bold'; ageHolder.style.fontSize = '16px'
            nameHolder.style.fontWeight = 'bold'; nameHolder.style.fontSize = '16px'
            var patientInfo = document.getElementById("patientInfo");
            patientInfo.style.fontWeight = 'bold'; patientInfo.style.fontSize = '25px'
            patientName.style.fontSize = '16px'
            patientAge.style.fontSize = '16px'
            // patientName.value = " ";
            // patientAge.value = " ";
            patientInfo.innerHTML = "Patient Information";
            // patientName.innerHTML = "Name: " + patientObject.name;
            // patientAge.innerHTML = "Age: " + patientObject.age;
            patientName.innerHTML = patientObject.name;
            patientAge.innerHTML = patientObject.age;
            patientNurse.innerHTML = patientObject.nurseEmail;
            nameHolder.innerHTML = "Patient Name";
            ageHolder.innerHTML = "Age";
            emailHolder.innerHTML = "Attending Nurse";
            posHolder.innerHTML = "Current Position";

            var patientTable = document.getElementById("patientTable");
            
            tableCaption.innerHTML = "Patient Thresholds";
            // $("#patientTable").css("border", "1px solid #000");

            $("#patientTable").append(`\
            <thead>/
            <tr>\
                <th rowspan="2">Thresholds</th>\
                <th>Blood Pressure (mmHg)</th>\
                <th>Pulse Rate (bpm)</th>\
                <th>Temperature (°C)</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td></td>\
                <td>${patientObject.bpSysLow}/${patientObject.bpDiasLow}-${patientObject.bpSysHigh}/${patientObject.bpDiasHigh}</td>\
                <td>${patientObject.pulseRateLow}-${patientObject.pulseRateHigh}</td>\
                <td>${patientObject.temperatureLow}-${patientObject.temperatureHigh}</td>\
            </tr>\
            </tbody>\
            `)
        });

        $.get("http://192.168.1.128:3000/patient/all/"+patientId, function(data, status){
            var patientData = data; var tempState; var bpState; var pulseState;
 
            patientData.map((patient)=>{
                if (patient.date != null){
                    if (patient.tempAlert === true){
                        tempState = "yes";
                    }
                    else{
                        tempState = "no";
                    }
                    if (patient.bpAlert === true){
                        bpState = "yes";
                    }
                    else{
                        bpState = "no";
                    }
                    if (patient.pulseAlert === true){
                        pulseState = "yes";
                    }
                    else{
                        pulseState = "no";
                    }
             $("#tmpTable").append(`\
            <thead>/
            <tr>\
                <th>Temperature(°C)</th>\
                <th>Date</th>\
                <th>Alert</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patient.temperatureCur}</td>\
                <td>${patient.date}</td>\
                <td>${tempState}</td>\
            </tr>\
            </tbody>\
            `)

            $("#bpTable").append(`\
            <thead>/
            <tr>\
                <th>Systolic (mmHg)</th>\
                <th>Diastolic (mmHg)</th>\
                <th>Date</th>\
                <th>Alert</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patient.bloodPressureSys}</td>\
                <td>${patient.bloodPressureDias}</td>\
                <td>${patient.date}</td>\
                <td>${bpState}</td>\
            </tr>\
            </tbody>\
            `)

            $("#pulseTable").append(`\
            <thead>/
            <tr>\
                <th>Pulse Rate(bpm)</th>\
                <th>Date</th>\
                <th>Alert</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patient.pulseRateCur}</td>\
                <td>${patient.date}</td>\
                <td>${pulseState}</td>\
            </tr>\
            </tbody>\
            `)

        }
        if (patient.positionCur === "1"){
            document.getElementById("patientPos").innerHTML = "Upright   ";
        }
        else {
            document.getElementById("patientPos").innerHTML = "Lying down";
        }
    })
            
        });
});
</script>

<script>
    document.getElementById("search").addEventListener("click", function(e){
        e.preventDefault();
        var dataPointsSys = [];
        var dataPointsDias = [];
        var chart = new CanvasJS.Chart("chartContainerBP",{
            title:{
                text:"Patient Blood Pressure Chart"
            },
            axisY:{
                title: "Blood Pressure",
                stripLines:[{
                }]
            },
            axisX:{
                title: "Date"
            },
            data:[{
                type: "line",
                axisYType: "secondary",
                dataPoints : dataPointsSys,
                name: "Systolic",
                showInLegend: true
            },
            {
                type: "line",
                axisYType: "secondary",
                dataPoints : dataPointsDias,
                name: "Diastolic",
                showInLegend: true
            }
        ]
        });
        var patientId = $("#singlePatient").val();
        $.getJSON(`http://192.168.1.128:3000/patient/all/${patientId}`, function(data, status){
            $.each(data, function(key, value){
                console.log(value.bloodPressureCur)
                dataPointsSys.push({x: new Date(value.fullDate), y: parseInt(value.bloodPressureSys)});
                dataPointsDias.push({x: new Date(value.fullDate), y: parseInt(value.bloodPressureDias)});
                // chart.options.stripLines.value= value.bloodPressureHigh
            });
            chart.render();
            // updateChart();
        });

        // function updateChart() {
        //     $.getJSON(`http://192.168.1.128:3000/patient/all/${patientId}`, function(data) {
        //         $.each(data, function(key, value) {
        //             dataPointsBP.push({
        //                 x: value.date,
        //                 y: parseInt(value.bloodPressureCur)
        //             });
        //         });
        //         chart.render();
        //         setTimeout(function(){updateChart()}, 1000);
        //     });
        // }
        // document.getElementById("singlePatient").value=" ";
}); 
</script>
    
<script> 
    // function compareDataPointX(dataPoint1, dataPoint2){
    //     return dataPoint1.x - dataPoint2.x;
    // }
    document.getElementById("search").addEventListener("click", function(e){
        e.preventDefault();

        var dataPointsTMP = [];
        var chart = new CanvasJS.Chart("chartContainerTMP",{
            title:{
                text:"Patient Temperature Chart"
            },
            axisY:{
                title: "Temperature",
                stripLines:[{
                    // value: thresholds
                }]
            },
            axisX:{
                title: "Date"
            },
            data:[{
                type: "line",
                dataPoints : dataPointsTMP,
            }]
        });
        // chart.options.data[0].dataPoints.sort(compareDataPointX);

        var patientId = $("#singlePatient").val();
        $.getJSON(`http://192.168.1.128:3000/patient/all/${patientId}`, function(data, status){
            $.each(data, function(key, value){
                if (value.date != null){
                console.log(value.temperatureCur)
                dataPointsTMP.push({x: new Date(value.fullDate), y: parseInt(value.temperatureCur)});
                // chart.options.stripLines.value= value.bloodPressureHigh
            }});
            chart.render();
            // updateChart();
        });

        // function updateChart() {
        //     $.getJSON(`http://192.168.1.128:3000/patient/all/${patientId}/`, function(data) {
        //         $.each(data, function(key, value) {
        //             dataPointsTMP.push({
        //                 x: value.date,
        //                 y: parseInt(value.temperatureCur)
        //             });
        //         });
        //         chart.render();
        //         setTimeout(function(){updateChart()}, 1000);
        //     });
        // } 
    });
</script>

<script> 
    document.getElementById("search").addEventListener("click", function(e){
        e.preventDefault();

        var dataPointsHRM = [];
        var chart = new CanvasJS.Chart("chartContainerHRM",{
            title:{
                text:"Patient Pulse Rate Chart"
            },
            axisY:{
                title: "Beats per Minute",
                stripLines:[{
                    // value:150 thresholds
                }]
            },
            axisX:{
                title: "Date"
            },
            data:[{
                type: "line",
                dataPoints : dataPointsHRM,
            }]
        });
        var patientId = $("#singlePatient").val();
        $.getJSON(`http://192.168.1.128:3000/patient/all/${patientId}`, function(data, status){
            $.each(data, function(key, value){
                console.log(value.pulseRateCur)
                dataPointsHRM.push({x: new Date(value.fullDate), y: parseInt(value.pulseRateCur)});
                // chart.options.stripLines.value= value.bloodPressureHigh
            });
            chart.render();
            // updateChart();
        });

        // function updateChart() {
        //     $.getJSON(`http://192.168.1.128:3000/patient/all/${patientId}`, function(data) {
        //         $.each(data, function(key, value) {
        //             dataPointsHRM.push({
        //                 x: value.date,
        //                 y: parseInt(value.pulseRateCur)
        //             });
        //         });
        //         chart.render();
        //         setTimeout(function(){updateChart()}, 1000);
        //     });
        // }
    }); 
</script>

<script> /*
    document.getElementById("search").addEventListener("click", function(e){
        e.preventDefault();
    var patientId = $("#singlePatient").val();
    $.get(`http://192.168.1.128:3000/patient/all/${patientId}`, function(patientObject, status){
    var bpTable = document.getElementById("bpTable");
            
            bpTableCaption.innerHTML = "Patient Blood Pressure";
            tempTableCaption.innerHTML = "Patient Temperature";
            pulseTableCaption.innerHTML = "Patient Pulse Rate";

            $("#bpTable").append(`\
            <thead>/
            <tr>\
                <th>Blood Pressure(mmHg)</th>\
                <th>Date</th>\
                <th>Alert</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patientObject.bloodPressureCur}</td>\
                <td>${patientObject.date}</td>\
                <td>${patientObject.alerts}</td>\
            </tr>\
            </tbody>\
            `)

            $("#tmpTable").append(`\
            <thead>/
            <tr>\
                <th>Temperature(C)</th>\
                <th>Date</th>\
                <th>Alert</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patientObject.temperatureCur}</td>\
                <td>${patientObject.date}</td>\
                <td>${patientObject.alerts}</td>\
            </tr>\
            </tbody>\
            `)

            $("#pulseTable").append(`\
            <thead>/
            <tr>\
                <th>Pulse Rate(bpm)</th>\
                <th>Date</th>\
                <th>Alert</th>\
            </tr>\
            </thead>\
            <tbody>\
            <tr>\
                <td>${patientObject.pulseRateCur}</td>\
                <td>${patientObject.date}</td>\
                <td>${patientObject.alerts}</td>\
            </tr>\
            </tbody>\
            `)
        });
    }); */
</script> 

</body>
</html>